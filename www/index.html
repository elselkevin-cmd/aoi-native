<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A.O.I. – Artificial Otto Intelligence</title>
  <meta name="theme-color" content="#4A90E2">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="aoi-icon-192.png" type="image/png">
  <link rel="apple-touch-icon" href="aoi-icon-512.png">


  <style>
  :root {
    /* DUNKEL als Standard */
    --primary:        #4A90E2;
    --bg:             #121212;
    --card:           #1e1e1e;
    --text:           #e0e0e0;
    --input-bg:       #333333;
    --input-border:   transparent;
    --aoi-bg:         #333333;
    --btn-bg:         #333333;
  }

  .light {
    /* Hell nur, wenn .light aktiv */
    --bg:             #f5f7fa;
    --card:           #ffffff;
    --text:           #2c3e50;
    --input-bg:       #ffffff;
    --input-border:   #dddddd;
    --aoi-bg:         #e9ecef;
    --btn-bg:         var(--primary);
  }

  /* Grundlayout */
  body {
    font-family: 'Segoe UI', sans-serif;
    background: var(--bg);
    color: var(--text);
    margin: 0;
    transition: background 0.4s, color 0.4s;
  }

  #app {
    max-width: 600px;
    margin: 0 auto;
    background: var(--card);
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
  }

  header {
    background: var(--primary);
    color: white;
    padding: 20px;
    text-align: center;
    position: relative;
  }

  .logo-svg {
    width: 80px;
    height: 80px;
    margin-bottom: 10px;
  }

  .dark-toggle {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(255, 255, 255, 0.2);
    border: none;
    border-radius: 50%;
    width: 44px;
    height: 44px;
    font-size: 22px;
    cursor: pointer;
  }

  #chat {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    background: var(--card);
  }

  .message {
    margin: 15px 0;
    padding: 14px 18px;
    border-radius: 20px;
    max-width: 85%;
    line-height: 1.5;
  }

  .user {
    background: var(--primary);
    color: white;
    margin-left: auto;
    border-bottom-right-radius: 4px;
  }

  .aoi {
    background: var(--aoi-bg);
    color: var(--text);
    margin-right: auto;
    border-bottom-left-radius: 4px;
  }

  .buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    padding: 15px;
    justify-content: center;
    background: var(--card);
    border-top: 1px solid #ddd;
  }

  .btn {
    background: var(--btn-bg);
    color: white;
    border: none;
    padding: 12px 16px;
    border-radius: 30px;
    cursor: pointer;
    font-size: 14px;
  }

  #input-area {
    display: flex;
    padding: 15px;
    background: var(--card);
    border-top: 1px solid #ddd;
  }

  #question-input {
    flex: 1;
    padding: 14px 18px;
    background: var(--input-bg);
    border: 1px solid var(--input-border);
    border-radius: 30px;
    font-size: 16px;
    outline: none;
    color: var(--text);
  }

  #mic-btn {
    width: 50px;
    height: 50px;
    margin-left: 10px;
    border-radius: 50%;
    background: var(--primary);
    color: white;
    border: none;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .listening {
    animation: pulse 1.5s infinite;
  }

  @keyframes pulse {
    0%   { box-shadow: 0 0 0 0 rgba(74, 144, 226, 0.8); }
    70%  { box-shadow: 0 0 0 15px rgba(74, 144, 226, 0); }
    100% { box-shadow: 0 0 0 0 rgba(74, 144, 226, 0); }
  }
</style>
</head>
<body class="dark">
  <div id="app">
    <header>
      <img src="aoi-logo.png" alt="A.O.I. Logo" class="logo-svg">
      <h1 style="color:#000000 !important; text-shadow: 0 2px 2px rgba(0,0,0,0.3);">A.O.I.</h1>
      <button class="dark-toggle" id="darkToggle">D/L</button>
    </header>

    <div id="chat">
      <div class="message aoi">Was geht?</div>
    </div>

    <div class="buttons">
      <button class="btn" id="weatherBtn">Wetter</button>
      <button class="btn" id="calendarBtn">Kalender</button>
      <button class="btn" id="smartHomeBtn">Smart Home</button>
    </div>

    <div id="input-area">
      <input type="text" id="question-input" placeholder="Frag mich was..." autocomplete="off">
      <button id="mic-btn">Mic</button>
    </div>
  </div>

  <script>
    const chat = document.getElementById('chat');
    const input = document.getElementById('question-input');
    const micBtn = document.getElementById('mic-btn');
    const darkToggle = document.getElementById('darkToggle');

darkToggle.onclick = () => document.body.classList.toggle('light');
    function setLoading(l) { input.disabled = micBtn.disabled = l; micBtn.classList.toggle('listening', l); }
    function add(msg, who='aoi') {
      const div = document.createElement('div');
      div.className = `message ${who}`;
      div.textContent = msg;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }
    function speak(t) { new SpeechSynthesisUtterance(t).lang='de-DE'; speechSynthesis.speak(new SpeechSynthesisUtterance(t)); }

    async function askAOI(q) {
      add(q, 'user');
      add('A.O.I. denkt...', 'aoi');
      setLoading(true);
      try {
        const res = await fetch('https://a-o-i-backend.onrender.com/api/ask', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({question:q})});
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const answer = `"${q}"`;
        chat.lastChild.textContent = `A.O.I.: ${answer}`;
        speak(answer);
      } catch(e) { chat.lastChild.textContent = `Fehler: ${e.message}`; }
      finally { setLoading(false); input.value=''; input.focus(); }
    }

    // Mikrofon
    micBtn.onclick = () => {
      setLoading(true);
      add('Ich höre zu...', 'aoi');
      if (!('SpeechRecognition' in window || 'webkitSpeechRecognition' in window)) { setLoading(false); input.focus(); return; }
      const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      rec.lang = 'de-DE';
      rec.onresult = e => { const text = e.results[0][0].transcript.trim(); input.value = text; askAOI(text); };
      rec.onerror = () => { setLoading(false); input.focus(); };
      rec.start();
    };

    // Enter
    input.addEventListener('keypress', e => { if (e.key==='Enter' && input.value.trim()) askAOI(input.value.trim()); });

    // Buttons direkt im Chat
    document.getElementById('weatherBtn').onclick = async () => {
      add('Wetter wird abgefragt...', 'aoi');
      setLoading(true);
      try {
        const res = await fetch('https://a-o-i-backend.onrender.com/api/weather', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({city:"Berlin"})});
        const d = await res.json();
        const txt = `Wetter in ${d.name}: ${Math.round(d.main.temp)}°C, ${d.weather[0].description}`;
        chat.lastChild.textContent = txt; speak(txt);
      } catch { chat.lastChild.textContent = 'Wetter-API Fehler'; } finally { setLoading(false); }
    };

    document.getElementById('calendarBtn').onclick = async () => {
      add('Kalender wird geladen...', 'aoi');
      setLoading(true);
      try {
        const res = await fetch('https://a-o-i-backend.onrender.com/api/calendar', {method:'POST',headers:{'Content-Type':'application/json'}});
        const d = await res.json();
        const events = d.events.map(e => `${e.time}: ${e.title}`).join('\n');
        const txt = `Deine Termine heute:\n${events || 'Keine Termine'}`;
        chat.lastChild.textContent = txt; speak(txt.replace('\n', ', '));
      } catch { chat.lastChild.textContent = 'Kalender Fehler'; } finally { setLoading(false); }
    };

    document.getElementById('smartHomeBtn').onclick = async () => {
      const cmd = prompt("Smart-Home-Befehl:", "Licht an");
      if (!cmd) return;
      add(`Führe aus: ${cmd}...`, 'aoi');
      setLoading(true);
      try {
        const res = await fetch('https://a-o-i-backend.onrender.com/api/smart-home', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({command:cmd})});
        const d = await res.json();
        chat.lastChild.textContent = d.status; speak(d.status);
      } catch { chat.lastChild.textContent = 'Smart-Home Fehler'; } finally { setLoading(false); }
    };

    input.focus();
  </script>
</body>
</html>